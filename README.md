# Carina: è½»é‡çº§ E-Hentai API ä»£ç†ä¸Žå¢žå¼ºä¸­é—´ä»¶

**Carina** (èˆ¹åº•åº§) æ˜¯ä¸€ä¸ªåŸºäºŽ PHP å’Œ SQLite æž„å»ºçš„é«˜æ€§èƒ½ E-Hentai API ä»£ç†æœåŠ¡ã€‚ä½œä¸ºè¿žæŽ¥å®¢æˆ·ç«¯ä¸Ž E-Hentai çš„æ¡¥æ¢ï¼Œå®ƒä¸ä»…æä¾›ç”»å»Šæœç´¢ä¸Žå…ƒæ•°æ®è§£æžï¼Œæ›´å†…ç½®äº†å¼ºå¤§çš„**å›¾ç‰‡æ™ºèƒ½é¢„å¤„ç†å¼•æ“Ž**ï¼Œæ”¯æŒè‡ªåŠ¨åŽŸå›¾è§£æžã€WebP è‡ªåŠ¨è½¬ç  JPEGã€é›ªç¢§å›¾ç²¾å‡†è£å‰ªåŠæµå¼é€ä¼ ï¼Œä¸“ä¸ºæå‡ä½ŽåŠŸè€—è®¾å¤‡ä¸Žç§»åŠ¨ç«¯çš„é˜…è¯»ä½“éªŒè€Œç”Ÿã€‚

## æ ¸å¿ƒç‰¹æ€§

*   **âš¡ æžé€Ÿè½»é‡**: é›¶ä¾èµ–éƒ¨ç½²ï¼Œä»…éœ€ PHP + SQLiteï¼Œæ— éœ€å¤æ‚çš„æ•°æ®åº“ç»´æŠ¤ã€‚
*   **ðŸ” æ·±åº¦è§£æž**: æ”¯æŒ E-Hentai é«˜çº§æœç´¢è¯­æ³•ï¼Œå®Œç¾Žè§£æžç”»å»Šè¯¦æƒ…ã€æ ‡ç­¾ä¸Žè¯„è®ºï¼Œæ”¯æŒ MPV ä¸Žæ™®é€šç”»å»Šæ¨¡å¼ã€‚
*   **ðŸ–¼ï¸ æ™ºèƒ½å›¾åºŠ**:
    *   **è‡ªåŠ¨åŽŸå›¾**: ä¼ å…¥å•é¡µåœ°å€å³å¯è‡ªåŠ¨è§£æžçœŸå®žå›¾ç‰‡ URLã€‚
    *   **æ ¼å¼ç»Ÿä¸€**: è‡ªåŠ¨å°† WebP/AVIF è½¬ç ä¸ºå…¼å®¹æ€§æœ€å¥½çš„ JPEGã€‚
    *   **é›ªç¢§å›¾è¿˜åŽŸ**: æœåŠ¡å™¨ç«¯è‡ªåŠ¨è£å‰ªå¤„ç† E-Hentai çš„é›ªç¢§å›¾ (Sprite Sheet)ï¼Œå®¢æˆ·ç«¯æ— éœ€å¤„ç† CSS åç§»ã€‚
    *   **æŒ‰éœ€ç¼©æ”¾**: æ”¯æŒ `w`/`h` å‚æ•°å®žæ—¶ç¼©æ”¾å›¾ç‰‡ï¼ŒèŠ‚çœå¸¦å®½ã€‚
*   **ðŸš€ é«˜æ€§èƒ½ç¼“å­˜**: å†…ç½®åŒå±‚ç¼“å­˜æœºåˆ¶ï¼Œæœ‰æ•ˆé™ä½Žæºç«™è¯·æ±‚é¢‘çŽ‡ï¼Œæå‡å“åº”é€Ÿåº¦ã€‚

## ç›®å½•ç»“æž„

```
carina/
â”œâ”€â”€ composer.json       # ä¾èµ–å®šä¹‰
â”œâ”€â”€ config.php          # é…ç½®æ–‡ä»¶
â”œâ”€â”€ index.php           # API å…¥å£
â”œâ”€â”€ init.php            # åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ test.html           # Carina æµ‹è¯•æŽ§åˆ¶å°
â”œâ”€â”€ data/               # æ•°æ®ç›®å½• (SQLite æ–‡ä»¶)
â”œâ”€â”€ logs/               # æ—¥å¿—ç›®å½•
â””â”€â”€ src/                # æ ¸å¿ƒä»£ç 
    â”œâ”€â”€ Database.php    # SQLite æ•°æ®åº“æ“ä½œ
    â”œâ”€â”€ EHService.php   # ä¸šåŠ¡é€»è¾‘
    â””â”€â”€ Logger.php      # æ—¥å¿—ç±»
```

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

ç¡®ä¿ä½ å·²å®‰è£… Composerã€‚åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œï¼š

```bash
composer install
```

> **æ³¨æ„**: å¦‚æžœä½ çš„çŽ¯å¢ƒä¸ŽåŽŸ `xrtuku` é¡¹ç›®åœ¨åŒä¸€å°æœºå™¨ä¸”ç›®å½•ç›¸é‚»ï¼Œæœ¬é¡¹ç›®ä¼šå°è¯•è‡ªåŠ¨åŠ è½½ `../vendor/autoload.php`ã€‚ä½†åœ¨ç‹¬ç«‹éƒ¨ç½²æ—¶ï¼Œå¿…é¡»æ‰§è¡Œä¸Šè¿°å‘½ä»¤ã€‚

### 2. åˆå§‹åŒ–

è¿è¡Œåˆå§‹åŒ–è„šæœ¬ä»¥åˆ›å»ºæ•°æ®ç›®å½•å’Œæ•°æ®åº“è¡¨ç»“æž„ï¼š

```bash
php init.php
```

æˆ–è€…ç›´æŽ¥è®¿é—® `index.php`ï¼Œç³»ç»Ÿä¹Ÿä¼šå°è¯•è‡ªåŠ¨åˆå§‹åŒ–ã€‚

### 3. è¿è¡Œ

é…ç½®ä½ çš„ Web æœåŠ¡å™¨ï¼ˆNginx/Apacheï¼‰æŒ‡å‘è¯¥ç›®å½•ï¼Œæˆ–è€…ä½¿ç”¨ PHP å†…ç½®æœåŠ¡å™¨æµ‹è¯•ï¼š

```bash
php -S 0.0.0.0:8000
```

è®¿é—®æµ‹è¯•æŽ§åˆ¶å°ï¼š`http://localhost:8000/test.html`

## API æ–‡æ¡£

### Base URL

`/index.php` (æˆ–è€…é…ç½®ä¼ªé™æ€éšè— index.php)

### Endpoints

*   `GET /search`: æœç´¢ç”»å»Š
    *   `q`: å…³é”®è¯ (ä¾‹å¦‚ `language:chinese`)
    *   `next`: ä¸‹ä¸€é¡µ ID
    *   `refresh`: `1` å¼ºåˆ¶åˆ·æ–°ç¼“å­˜
*   `GET /gallery`: èŽ·å–è¯¦æƒ…
    *   `gid`: ç”»å»Š ID
    *   `token`: ç”»å»Š Token
    *   `fetchAllImages`: `1` (é»˜è®¤) èŽ·å–å›¾ç‰‡åˆ—è¡¨
*   `GET /image/proxy`: å›¾ç‰‡ä»£ç†
    *   `url`: å›¾ç‰‡é“¾æŽ¥æˆ–å•é¡µåœ°å€ (å¦‚ `https://e-hentai.org/s/...`)
    *   `w`, `h`: ç¼©æ”¾å®½é«˜
    *   `q`: è´¨é‡ (1-100)

## é…ç½®

ä¿®æ”¹ `config.php` å¯ä»¥è°ƒæ•´æ•°æ®åº“è·¯å¾„æˆ–ä»£ç†è®¾ç½®ã€‚

```php
return [
    'db' => [
        'path' => __DIR__ . '/data/database.sqlite',
    ],
    // ...
];
```

## éƒ¨ç½²å»ºè®®

*   ç¡®ä¿ `data/` å’Œ `logs/` ç›®å½•å…·æœ‰å†™å…¥æƒé™ã€‚
*   ç”Ÿäº§çŽ¯å¢ƒå»ºè®®å¼€å¯ HTTPSã€‚
*   å¦‚æžœæ˜¯å›½å†…çŽ¯å¢ƒï¼Œå»ºè®®é…ç½® `XR_EH_PROXY` çŽ¯å¢ƒå˜é‡æˆ–åœ¨ `config.php` ä¸­æŒ‡å®šä»£ç†ã€‚

## ç‰ˆæƒä¸Žè‡´è°¢ (License & Credits)

æœ¬é¡¹ç›®ç”± **YcFeller** å¼€å‘ä¸Žç»´æŠ¤ã€‚

*   **æ ¸å¿ƒæ€è·¯å‚è€ƒ**: æœ¬é¡¹ç›®åœ¨å¼€å‘è¿‡ç¨‹ä¸­å‚è€ƒäº† [vela-py-eh-api-server](https://github.com/OrPudding/vela-py-eh-api-server/) é¡¹ç›®çš„è®¾è®¡æ€è·¯ä¸Žéƒ¨åˆ†é€»è¾‘ã€‚
*   **èžåˆå¼€å‘**: ç»“åˆ PHP ç”Ÿæ€ç‰¹æ€§è¿›è¡Œäº†é‡æž„ä¸Žä¼˜åŒ–ï¼Œæ—¨åœ¨æä¾›æ›´è½»é‡ã€æ˜“éƒ¨ç½²çš„ PHP ç‰ˆæœ¬å®žçŽ°ã€‚
*   **å¼€æºåè®®**: éµå¾ª MIT License (æ²¿ç”¨å‚è€ƒé¡¹ç›®çš„å¼€æºç²¾ç¥ž)ã€‚

> Special thanks to **OrPudding** for the inspiration and original implementation in Python.
